# Общий подход к реализации multi-tenancy в KC.

Для реализации мультитанантности используются Realms. Realm  - изолированные пространства в KC. Изолированные - значит между ними нет общих клиентов или поставщиков персональных данных. Пользователь/администратор из одного пространства не может получить информацию о пользователях из другого пространства. Поэтому из коробки KC не предоставляет возможности реализации мультитанантности. 

Поэтому есть возможность рассмотреть три варианта :

## Вариант 1. 1 Ream - N tenant.
*Объединение всех клиентов, пользователей и настроек в одной области.*

Объединить всех поставщиков персональных данных, клиентов, и пр. в одном Realm. И использовать управление пользователями на уровне ролей в рамках одного Realm. 
Пока в релизе KC нет прав администратора, представляющих детализированный контроль группой или группами пользователей. Есть возможность использовать расширение SPI для управления группами пользователей на уровне организации. Вводя дополнительную структуру, которая позволяет использовать мультитонантность в одной области. 
Есть ограничения *(рассмотрено ниже)*.


## Вариант 2. 1 Realm - 1 Tenant.
*Создание отдельной области для каждого тенанта.*

В этом случае нужно настроить каждого клиента или нескольких клиентов в каждом Realm. И каждый клиент должен уметь обрабатывать всех поставщиков персональных данных и всех URI от каждого Realm. При добавлении нового тенанта нужно добавлять новый Realm и на лету нужно добавлять информацию о нем в каждый клиент. 
Есть мнение комьюнити, что количество таких Realms ограничено 300. Потом идет некомпенисруемое замедление работы сервиса. 

## Вариант 3. N tenant-reams - 1 app realm
*Создание общей области для приложений и клиентов.*

Для каждого тенанта создается отдельный Realm (tenant-realm). И отдельно создается Realm для приложения(app-realm). App-realm является прокси для идентификации тенантов. Все приложения используют клиенты app-realm. Пользовать проходит аутентификацию в tenant-realm, затем переправляется в app-realm. Это позволяет разделить управление администраторами тенанта только своими пользователями. 

Ограничением является дублирование ресурсов. В tenant-realm пользователь проходит аутентификацию, ему создается контекст и это контекст будет создан в app-realm. Создаются две пользовательские сессии. Аллоцируется x2 памяти и дублируются данные в обоих хранилищах в tenant-realm и app-realm. 

# Реализация 1 Realm - 1 tenant используя SPI phase2

## Demo app

Демонстрационное приложение развёрнуто на виртуалке. Без domainname, поэтому используется кастомный сертификат. 

Для входа :
```yaml
uri : https://95.174.94.16/admin/master/console/#/demo
u : admin
p : password
realm : demo
```


